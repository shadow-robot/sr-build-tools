---
# Playbook for additional component installations

- name: Install more packages
  apt: 
    name: ['ros-{{ros_release}}-cmake-modules','python3-rosdep','python3-pip','cobertura','python3-bloom','fakeroot','libxml2-utils','libyubikey-dev','libykpers-1-dev']
  become: yes
  become_method: sudo
  become_user: root

- name: Install PIP modules
  pip: 
    name: ['catkin_pkg','empy==3.3.2','coverage','catkin-lint','pylint==2.10.2']
    extra_args: '--upgrade'
    executable: pip3
  become: yes
  become_method: sudo
  become_user: root

- name: Update users bashrc to point to the ROS installation
  lineinfile: dest={{ansible_env.HOME}}/.bashrc
              line="source /opt/ros/{{ros_release}}/setup.bash"
              regexp='^source.*/setup\.bash'
              insertafter=EOF
              backup=yes

- name: Install GitHub CLI
  block:
    - name: download gpg key and add to keyring
      shell: curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
      become: yes
      become_method: sudo
      become_user: root

    - name: Connect to GitHub CLI dpkg repo_sources_path
      shell: echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | tee /etc/apt/sources.list.d/github-cli.list > /dev/null
      become: yes
      become_method: sudo
      become_user: root

    - name: Upgrade apt and install GitHub CLI
      apt:
        name: ['gh']
        update_cache: yes
      become: yes
      become_method: sudo
      become_user: root
