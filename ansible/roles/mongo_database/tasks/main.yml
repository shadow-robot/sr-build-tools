# Copyright 2022 Shadow Robot Company Ltd.
#
# This program is free software: you can redistribute it and/or modify it
# under the terms of the GNU General Public License as published by the Free
# Software Foundation version 2 of the License.
#
# This program is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
# FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
# more details.
#
# You should have received a copy of the GNU General Public License along
# with this program. If not, see <http://www.gnu.org/licenses/>.

# Set up the mongodb databas
- name: Clone mongo-cxx-driver in {{workspace_path}}
  git:
    repo: 'https://github.com/mongodb/mongo-cxx-driver.git'
    version: 26compat
    dest: "{{workspace_path}}/src/mongo-cxx-driver"
    clone: yes
    depth: 1
    update: yes

- name: Install scons package
  become: yes
  apt:
    name: scons

- name: Install mongodb package
  become: yes
  apt:
    name: mongodb

- name: Build mongodb from source
  become: yes
  shell: scons --use-system-boost --prefix=/usr/local/ --full --disable-warnings-as-errors
  args:
    chdir: "{{workspace_path}}/src/mongo-cxx-driver"

- name: Download warehouse_ros_mongo source
  shell: bash -c "wstool set -yu warehouse_ros_mongo --git https://github.com/shadow-robot/warehouse_ros_mongo.git -v B_working_jade_devel"
    chdir={{workspace_path}}/src
    
- name: Download warehouse_ros source
  shell: bash -c "wstool set -yu warehouse_ros --git https://github.com/ros-planning/warehouse_ros.git -v kinetic-devel"
    chdir={{workspace_path}}/src

- name: Build the workspace
  shell: bash -c "source /opt/ros/{{ros_release}}/setup.bash && catkin_make"
    chdir={{workspace_path}}
