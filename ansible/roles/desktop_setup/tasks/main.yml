# Copyright 2022 Shadow Robot Company Ltd.
#
# This program is free software: you can redistribute it and/or modify it
# under the terms of the GNU General Public License as published by the Free
# Software Foundation version 2 of the License.
#
# This program is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
# FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
# more details.
#
# You should have received a copy of the GNU General Public License along
# with this program. If not, see <http://www.gnu.org/licenses/>.

---

- name: Install pycurl
  apt: name=python-pycurl state=present

- name: Add PyCharm ppa
  become: yes
  apt_repository:
    repo: 'ppa:ubuntu-desktop/ubuntu-make'
    filename: 'ppa_ubuntu_desktop_ubuntu_make_trusty'
    mode: 664

- name: Update package lists
  apt: update_cache=yes

- name: Install ubuntu make
  become: yes
  apt: 
    name: ubuntu-make 
    state: present

- name: Change umake directory owner and group
  become: yes
  file: path=/usr/share/umake/ state=directory mode=0777 owner="{{ros_user}}" group="{{ros_group}}" recurse=true

- name: Install programming tools
  become: yes
  become_user: "{{ros_user}}"
  shell: bash -c "yes | umake ide pycharm /usr/share/umake/ide/pycharm"
  
- name: Change pycharm app location
  become: yes
  command: cp ~{{ros_user}}/.local/share/applications/jetbrains-pycharm-ce.desktop /usr/share/applications

- name: Set workspace for pycharm icon
  lineinfile: dest=/usr/share/applications/jetbrains-pycharm-ce.desktop regexp=^Exec= line="Exec="/usr/share/umake/ide/pycharm/bin/pycharm.sh" %F"

- name: Set favorite icons
  shell: dbus-launch --exit-with-session gsettings set com.canonical.Unity.Launcher favorites "['application://ubiquity.desktop', 'application://jetbrains-pycharm-ce.desktop', 'application://terminator.desktop', 'application://nautilus.desktop', 'application://firefox.desktop', 'unity://running-apps', 'unity://expo-icon', 'unity://devices']"
  become_user: "{{ros_user}}"
