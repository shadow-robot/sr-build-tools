# Copyright 2022 Shadow Robot Company Ltd.
#
# This program is free software: you can redistribute it and/or modify it
# under the terms of the GNU General Public License as published by the Free
# Software Foundation version 2 of the License.
#
# This program is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
# FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
# more details.
#
# You should have received a copy of the GNU General Public License along
# with this program. If not, see <http://www.gnu.org/licenses/>.

# To install a private repo need to pass the auth sock (ssh agent
# forwarding) onto root (wont work for other users due to perms on the
# socket, which is good)
- name: Pass SSH_AUTH_SOCK through sudo
  lineinfile: dest=/etc/sudoers
             state=present
             insertbefore='^Defaults\s+env_reset'
             line='Defaults        env_keep+=SSH_AUTH_SOCK'
             validate='visudo -cf %s'
             backup=yes
