# Copyright 2022 Shadow Robot Company Ltd.
#
# This program is free software: you can redistribute it and/or modify it
# under the terms of the GNU General Public License as published by the Free
# Software Foundation version 2 of the License.
#
# This program is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
# FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
# more details.
#
# You should have received a copy of the GNU General Public License along
# with this program. If not, see <http://www.gnu.org/licenses/>.

# Fix pyassimp issue
- name: Remove pyassimp directory if it exist
  file:
     path: /tmp/assimp
     state: absent

- name: Clone pyassimp source code
  git:
    repo: 'https://github.com/assimp/assimp.git'
    version: 51520cb5f1adcb588a2533d450aace480c7cc3d4
    dest: "/tmp/assimp"
    clone: yes
    depth: 1 
    update: yes

- name: Build and install
  shell: bash -c "cmake CMakeLists.txt -G 'Unix Makefiles' && make && make install"
    chdir=/tmp/assimp
  become: yes

- name: Install
  shell: bash -c "python setup.py install"
    chdir=/tmp/assimp/port/PyAssimp
  become: yes

- name: Remove pyassimp directory after installation
  file:
     path: /tmp/assimp
     state: absent
  become: yes
